import{r as y,s as K,f as _,j as S,F as G,c as N}from"./index-fxAYbue4.js";function X(e){const{loading:t,src:n,srcSet:r,onLoad:o,onError:a,crossOrigin:s,sizes:d,ignoreFallback:c}=e,[i,m]=y.useState("pending");y.useEffect(()=>{m(n?"loading":"pending")},[n]);const f=y.useRef(),D=y.useCallback(()=>{if(!n)return;h();const u=new Image;u.src=n,s&&(u.crossOrigin=s),r&&(u.srcset=r),d&&(u.sizes=d),t&&(u.loading=t),u.onload=b=>{h(),m("loaded"),o==null||o(b)},u.onerror=b=>{h(),m("failed"),a==null||a(b)},f.current=u},[n,s,r,d,o,a,t]),h=()=>{f.current&&(f.current.onload=null,f.current.onerror=null,f.current=null)};return K(()=>{if(!c)return i==="loading"&&D(),()=>{h()}},[i,D,c]),c?"loaded":i}const $=(e,t)=>e!=="loaded"&&t==="beforeLoadOrError"||e==="failed"&&t==="onError",B=_(function(t,n){const{htmlWidth:r,htmlHeight:o,alt:a,...s}=t;return S.jsx("img",{width:r,height:o,ref:n,alt:a,...s})});B.displayName="NativeImage";const z=_(function(t,n){const{fallbackSrc:r,fallback:o,src:a,srcSet:s,align:d,fit:c,loading:i,ignoreFallback:m,crossOrigin:f,fallbackStrategy:D="beforeLoadOrError",referrerPolicy:h,...u}=t,b=r!==void 0||o!==void 0,P=i!=null||m||!b,W=X({...t,crossOrigin:f,ignoreFallback:P}),U=$(W,D),M={ref:n,objectFit:c,objectPosition:d,...P?u:G(u,["onError","onLoad"])};return U?o||S.jsx(N.img,{as:B,className:"chakra-image__placeholder",src:r,...M}):S.jsx(N.img,{as:B,src:a,srcSet:s,crossOrigin:f,loading:i,referrerPolicy:h,className:"chakra-image",...M})});z.displayName="Image";const de=(e,t)=>{if(!(e!=null&&e.buffer)||!(e.buffer instanceof ArrayBuffer))return t||"";const n=new Blob([e.buffer],{type:e.type});return URL.createObjectURL(n)},H="reward-card-db",I={CARD_LIST:"cardList"},ue={INFO:"info",WARNING:"warning",SUCCESS:"success",ERROR:"error",LOADING:"loading"},fe=10,J="https://yixuan173.github.io/reward-card",le=`${J}/images`,C=(e,t)=>t.some(n=>e instanceof n);let O,k;function Q(){return O||(O=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Y(){return k||(k=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const A=new WeakMap,E=new WeakMap,w=new WeakMap;function Z(e){const t=new Promise((n,r)=>{const o=()=>{e.removeEventListener("success",a),e.removeEventListener("error",s)},a=()=>{n(l(e.result)),o()},s=()=>{r(e.error),o()};e.addEventListener("success",a),e.addEventListener("error",s)});return w.set(t,e),t}function q(e){if(A.has(e))return;const t=new Promise((n,r)=>{const o=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",s),e.removeEventListener("abort",s)},a=()=>{n(),o()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",a),e.addEventListener("error",s),e.addEventListener("abort",s)});A.set(e,t)}let R={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return A.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return l(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function v(e){R=e(R)}function ee(e){return Y().includes(e)?function(...t){return e.apply(T(this),t),l(this.request)}:function(...t){return l(e.apply(T(this),t))}}function te(e){return typeof e=="function"?ee(e):(e instanceof IDBTransaction&&q(e),C(e,Q())?new Proxy(e,R):e)}function l(e){if(e instanceof IDBRequest)return Z(e);if(E.has(e))return E.get(e);const t=te(e);return t!==e&&(E.set(e,t),w.set(t,e)),t}const T=e=>w.get(e);function ne(e,t,{blocked:n,upgrade:r,blocking:o,terminated:a}={}){const s=indexedDB.open(e,t),d=l(s);return r&&s.addEventListener("upgradeneeded",c=>{r(l(s.result),c.oldVersion,c.newVersion,l(s.transaction),c)}),n&&s.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),d.then(c=>{a&&c.addEventListener("close",()=>a()),o&&c.addEventListener("versionchange",i=>o(i.oldVersion,i.newVersion,i))}).catch(()=>{}),d}const re=["get","getKey","getAll","getAllKeys","count"],oe=["put","add","delete","clear"],L=new Map;function p(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(L.get(t))return L.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,o=oe.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(o||re.includes(n)))return;const a=async function(s,...d){const c=this.transaction(s,o?"readwrite":"readonly");let i=c.store;return r&&(i=i.index(d.shift())),(await Promise.all([i[n](...d),o&&c.done]))[0]};return L.set(t,a),a}v(e=>({...e,get:(t,n,r)=>p(t,n)||e.get(t,n,r),has:(t,n)=>!!p(t,n)||e.has(t,n)}));const se=["continue","continuePrimaryKey","advance"],F={},x=new WeakMap,V=new WeakMap,ae={get(e,t){if(!se.includes(t))return e[t];let n=F[t];return n||(n=F[t]=function(...r){x.set(this,V.get(this)[t](...r))}),n}};async function*ce(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,ae);for(V.set(n,t),w.set(n,T(t));t;)yield n,t=await(x.get(n)||t.continue()),x.delete(n)}function j(e,t){return t===Symbol.asyncIterator&&C(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&C(e,[IDBIndex,IDBObjectStore])}v(e=>({...e,get(t,n,r){return j(t,n)?ce:e.get(t,n,r)},has(t,n){return j(t,n)||e.has(t,n)}}));const g=ne(H,1,{upgrade(e){e.objectStoreNames.contains(I.CARD_LIST)||e.createObjectStore(I.CARD_LIST,{keyPath:"id"})}}),Ie=async()=>{try{return await(await g).getAll(I.CARD_LIST)}catch(e){return console.error(e),[]}},he=async e=>{try{const n=await(await g).get(I.CARD_LIST,e);if(!n)throw new Error("Card not found");return n}catch(t){return console.error(t),null}},me=async e=>{await(await g).add(I.CARD_LIST,e)},be=async e=>{await(await g).put(I.CARD_LIST,e)},ge=async e=>{await(await g).delete(I.CARD_LIST,e)};export{ue as A,z as I,fe as M,me as a,le as b,de as c,ge as d,he as e,Ie as g,be as u};
