import{f as _,u as z,o as U,g as $,j as e,c as W,a as G,r as g,h as v,b as q,L as Z}from"./index-bICk6DLb.js";import{u as N,A as p,d as J,c as E,I as P,b as L,e as K}from"./indexedDB--j8kInva.js";import{h as A,u as b,M as S,a as D,b as T,c as k,d as F,e as I,F as H,N as Q,i as V,j as X,k as Y,l as ee,S as se,m as te,n as ne,o as ae,f as R,B as u,s as C,C as re,v as oe,W as ce,T as le,p as ie,q as de,r as w,t as O,w as xe,x as y,g as f,I as M,D as he}from"./toast-CA6Ji_7u.js";import{H as me}from"./Header-AMnz6qUJ.js";const B=_(function(t,s){const r=z("Text",t),{className:n,align:o,decoration:c,casing:a,...d}=U(t),l=$({textAlign:t.align,textDecoration:t.decoration,textTransform:t.casing});return e.jsx(W.p,{ref:s,className:G("chakra-text",t.className),...l,...d,__css:r})});B.displayName="Text";const je=A({displayName:"EditIcon",path:e.jsxs("g",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeWidth:"2",children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),ue=A({d:"M23.555,8.729a1.505,1.505,0,0,0-1.406-.98H16.062a.5.5,0,0,1-.472-.334L13.405,1.222a1.5,1.5,0,0,0-2.81,0l-.005.016L8.41,7.415a.5.5,0,0,1-.471.334H1.85A1.5,1.5,0,0,0,.887,10.4l5.184,4.3a.5.5,0,0,1,.155.543L4.048,21.774a1.5,1.5,0,0,0,2.31,1.684l5.346-3.92a.5.5,0,0,1,.591,0l5.344,3.919a1.5,1.5,0,0,0,2.312-1.683l-2.178-6.535a.5.5,0,0,1,.155-.543l5.194-4.306A1.5,1.5,0,0,0,23.555,8.729Z",displayName:"StarIcon"}),pe=i=>{const{isOpen:t,onClose:s,setCurrentCardData:r,currentCardData:n}=i,o=b(),{totalPoints:c,currentPoints:a}=n,[d,l]=g.useState(1),h=m=>{const j=typeof m=="string"?parseInt(m):m;l(j)},x=async m=>{try{const j={...n,currentPoints:a+m};await N(j),r(j),s()}catch(j){console.error(j),C(o,"新增點數失敗，請稍後再試。",p.ERROR)}};return e.jsxs(S,{onClose:s,size:"xs",isOpen:t,isCentered:!0,children:[e.jsx(D,{}),e.jsxs(T,{children:[e.jsx(k,{children:"新增"}),e.jsx(F,{}),e.jsx(I,{children:e.jsxs(H,{direction:"column",gap:4,children:["請輸入要增加的點數",e.jsxs(Q,{min:1,max:c-a,maxW:"100px",value:d,onChange:h,children:[e.jsx(V,{}),e.jsxs(X,{children:[e.jsx(Y,{}),e.jsx(ee,{})]})]}),e.jsxs(se,{min:1,max:c-a,width:"95%",flex:"1",focusThumbOnChange:!1,value:d,onChange:h,children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsx(ae,{fontSize:"sm",boxSize:"32px",children:d})]})]})}),e.jsxs(R,{children:[e.jsx(u,{mr:3,onClick:s,children:"取消"}),e.jsx(u,{colorScheme:"pink",onClick:()=>{x(d),l(1)},children:"蓋章"})]})]})]})},Ce=i=>{const{isOpen:t,onClose:s}=i,r=b(),{cardId:n=""}=v(),o=q(),c=async()=>{try{await J(n),C(r,"刪除成功！！",p.SUCCESS),s(),o("/list")}catch(a){console.error(a),C(r,"刪除失敗，請稍後再試。",p.ERROR)}};return e.jsxs(S,{onClose:s,isOpen:t,isCentered:!0,size:"xs",children:[e.jsx(D,{}),e.jsxs(T,{children:[e.jsx(k,{children:"刪除"}),e.jsx(I,{children:"是否要刪除集點卡？"}),e.jsxs(R,{children:[e.jsx(u,{mr:3,onClick:s,children:"取消"}),e.jsx(u,{colorScheme:"red",onClick:c,children:"刪除"})]})]})]})},ge=i=>{const{isOpen:t,onClose:s,currentCardData:r,setCurrentCardData:n}=i,o=b(),[c,a]=g.useState({}),d=async()=>{if(oe(r,a))try{await N(r),C(o,"更新成功！！",p.SUCCESS),s()}catch(l){console.error(l),C(o,"更新失敗，請稍後再試。",p.ERROR,e.jsx(ce,{mt:"5px"}))}};return e.jsxs(S,{onClose:s,isOpen:t,isCentered:!0,size:"sm",scrollBehavior:"inside",closeOnOverlayClick:!1,children:[e.jsx(D,{}),e.jsxs(T,{children:[e.jsx(k,{children:"編輯"}),e.jsx(I,{children:e.jsx(re,{mode:"edit",cardData:r,setCardData:n,errors:c,setErrors:a})}),e.jsxs(R,{children:[e.jsx(u,{mr:3,onClick:s,children:"取消"}),e.jsx(u,{colorScheme:"pink",onClick:d,children:"儲存"})]})]})]})},fe=i=>{const{isOpen:t,onClose:s,currentCardData:r,setCurrentCardData:n}=i,o=b(),{redemptionList:c,currentPoints:a}=r,d=c.sort((h,x)=>h.points-x.points),l=async h=>{if(!(a<h))try{const x={...r,currentPoints:a-h};await N(x),n(x),C(o,"兌換成功！！",p.SUCCESS),s()}catch(x){console.error(x),C(o,"兌換失敗，請稍後再試。",p.ERROR)}};return e.jsxs(S,{onClose:s,isOpen:t,isCentered:!0,size:"xs",children:[e.jsx(D,{}),e.jsxs(T,{children:[e.jsx(k,{children:"兌換"}),e.jsx(F,{}),e.jsx(I,{children:e.jsx(le,{mb:8,children:e.jsxs(ie,{children:[e.jsx(de,{children:e.jsxs(w,{children:[e.jsx(O,{children:"獎勵"}),e.jsx(O,{isNumeric:!0,children:"消耗點數"}),e.jsx(O,{})]})}),e.jsx(xe,{children:d.map(({id:h,content:x,points:m})=>e.jsxs(w,{children:[e.jsx(y,{children:x}),e.jsx(y,{isNumeric:!0,children:m}),e.jsx(y,{width:"10%",p:0,children:e.jsx(u,{colorScheme:"pink",size:"xs",onClick:()=>l(m),isDisabled:a<m,children:"兌換"})})]},h))})]})})})]})]})},be=i=>{const{currentCardData:t,setCurrentCardData:s}=i,{isOpen:r,onOpen:n,onClose:o}=f(),{isOpen:c,onOpen:a,onClose:d}=f(),{isOpen:l,onOpen:h,onClose:x}=f();return e.jsxs(e.Fragment,{children:[e.jsxs(H,{mb:2,justifyContent:"space-between",gap:6,children:[e.jsx(u,{leftIcon:e.jsx(ue,{}),colorScheme:"pink",flexGrow:1,onClick:()=>h(),children:"兌換獎勵"}),e.jsxs("div",{children:[e.jsx(M,{colorScheme:"blue","aria-label":"Edit data",icon:e.jsx(je,{}),mr:1,onClick:()=>a()}),e.jsx(M,{colorScheme:"red","aria-label":"Delete data",icon:e.jsx(he,{}),onClick:()=>n()})]})]}),e.jsx(Ce,{isOpen:r,onClose:o}),e.jsx(ge,{isOpen:c,onClose:d,currentCardData:t,setCurrentCardData:s}),e.jsx(fe,{isOpen:l,onClose:x,currentCardData:t,setCurrentCardData:s})]})},Se=`${L}/point.webp`,De=i=>{const{totalPoints:t,currentPoints:s,pointImage:r}=i,[n,o]=g.useState(!0),c=E(r,Se),a=()=>{setTimeout(()=>{o(!1)},500)};return Array.from({length:t},(d,l)=>e.jsxs("div",{className:"w-14 h-14 border-solid border-2 rounded-xl border-pink-500 flex items-center justify-center relative bg-pink-100/50",children:[e.jsx(B,{fontSize:"xl",as:"b",color:"pink.700",opacity:.6,children:l+1}),s>l&&e.jsxs("div",{className:`w-16 h-16 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex clip-circle ${n?"bg-white/80":""} `,children:[e.jsx("div",{className:`absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 -rotate-[30deg] w-16 h-16  bg-pink-200 animate-pulse ${n?"block":"hidden"}`}),e.jsx(P,{src:c,alt:"point",borderRadius:"full",objectFit:"cover",className:`-rotate-[30deg] w-full ${n?"opacity-0":"opacity-100"}`,onLoad:a})]})]},l))},Te=`${L}/cardHeader.webp`,Ne=()=>{const{cardId:i=""}=v(),{isOpen:t,onOpen:s,onClose:r}=f(),[n,o]=g.useState(null),{totalPoints:c=0,currentPoints:a=0,pointImage:d=null,cardHeaderImage:l=null}=n||{},h=E(l,Te),x=async m=>{const j=await K(m);o(j)};return g.useEffect(()=>{x(i)},[i]),e.jsxs("div",{className:"flex flex-col items-center h-screen",children:[e.jsx(me,{}),e.jsx("section",{className:"mt-12 w-full px-5 pb-8 max-w-lg",children:n?e.jsxs(e.Fragment,{children:[e.jsx(be,{currentCardData:n,setCurrentCardData:o}),e.jsxs("div",{className:"border-solid border-4 border-pink-500 rounded-xl p-2 flex flex-col items-center ",onClick:()=>{a<c&&s()},children:[e.jsx(P,{src:h,alt:"card-header-picture",objectFit:"cover",className:"w-full max-h-[200px]"}),e.jsx("div",{className:"grid grid-cols-5 gap-1 mt-3",children:e.jsx(De,{totalPoints:c,currentPoints:a,pointImage:d})}),e.jsx(pe,{isOpen:t,onClose:r,setCurrentCardData:o,currentCardData:n})]})]}):e.jsx("div",{children:e.jsxs("div",{className:"font-bold mt-6 text-center text-lg",children:["查無此集點卡，",e.jsx(Z,{to:"/",className:"underline",children:"返回首頁"})]})})})]})};export{Ne as default};
