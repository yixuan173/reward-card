import{r as c,i as z,c as y,f as M,u as V,o as $,j as e,a as B,b as K}from"./index-fxAYbue4.js";import{u as E,M as X,a as q,b as J,c as Q,d as Y,e as Z,C as ee,f as se,B as h,v as te,s as f,W as re,g as ne}from"./toast-COiqOmzM.js";import{a as ae,A as C,I as ie,b as oe,g as L,M as N}from"./indexedDB-TYF649fO.js";function ce(s){return c.Children.toArray(s).filter(t=>c.isValidElement(t))}function de(s,t){return Array.isArray(s)?s.map(r=>r===null?null:t(r)):z(s)?Object.keys(s).reduce((r,n)=>(r[n]=t(s[n]),r),{}):s!=null?t(s):null}const W=y("div");W.displayName="Box";const A=M(function(t,r){const n=V("Link",t),{className:a,isExternal:i,...o}=$(t);return e.jsx(y.a,{target:i?"_blank":void 0,rel:i?"noopener":void 0,ref:r,className:B("chakra-link",a),...o,__css:n})});A.displayName="Link";const D=s=>e.jsx(y.div,{className:"chakra-stack__item",...s,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...s.__css}});D.displayName="StackItem";function le(s){const{spacing:t,direction:r}=s,n={column:{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":de(r,a=>n[a])}}const O=M((s,t)=>{const{isInline:r,direction:n,align:a,justify:i,spacing:o="0.5rem",wrap:m,children:d,divider:l,className:T,shouldWrapChildren:j,...R}=s,g=r?"row":n??"column",v=c.useMemo(()=>le({spacing:o,direction:g}),[o,g]),u=!!l,b=!j&&!u,H=c.useMemo(()=>{const p=ce(d);return b?p:p.map((x,w)=>{const I=typeof x.key<"u"?x.key:w,F=w+1===p.length,_=j?e.jsx(D,{children:x},I):x;if(!u)return _;const G=c.cloneElement(l,{__css:v}),P=F?null:G;return e.jsxs(c.Fragment,{children:[_,P]},I)})},[l,v,u,b,j,d]),U=B("chakra-stack",T);return e.jsx(y.div,{ref:t,display:"flex",alignItems:a,justifyContent:i,flexDirection:g,flexWrap:m,gap:u?void 0:o,className:U,...R,children:H})});O.displayName="Stack";const k={buffer:null,type:""},S={id:"",cardHeaderImage:k,pointImage:k,cardImage:k,currentPoints:0,title:"",totalPoints:10,redemptionList:[]},me=s=>{const{isOpen:t,onClose:r}=s,n=E(),[a,i]=c.useState(S),[o,m]=c.useState({}),d=async()=>{if(te(a,m))try{const l={...a,id:crypto.randomUUID()};await ae(l),i(S),f(n,"集點卡新增成功！！",C.SUCCESS),r()}catch(l){console.error(l),f(n,"集點卡新增失敗，請稍後再試。",C.ERROR,e.jsx(re,{mt:"5px"}))}};return e.jsxs(X,{isOpen:t,onClose:r,closeOnOverlayClick:!1,isCentered:!0,scrollBehavior:"inside",size:"sm",children:[e.jsx(q,{}),e.jsxs(J,{children:[e.jsx(Q,{children:"新增"}),e.jsx(Y,{}),e.jsx(Z,{children:e.jsx(ee,{mode:"create",cardData:a,setCardData:i,errors:o,setErrors:m})}),e.jsxs(se,{children:[e.jsx(h,{mr:3,onClick:r,children:"取消"}),e.jsx(h,{colorScheme:"pink",onClick:d,children:"新增"})]})]})]})},ue="https://github.com/yixuan173/reward-card",xe=`${oe}/logo-github.svg`,je=()=>{const{isOpen:s,onOpen:t,onClose:r}=ne(),n=E(),a=K(),i=async()=>(await L()).length>=N,o=async()=>{if(await i()){f(n,`已達最大集點卡數量(${N}張)，無法繼續新增。`,C.WARNING);return}t()},m=async()=>{(await L()).length>0?a("/list"):f(n,"請先新增集點卡！！！",C.INFO)};return e.jsxs("div",{className:"h-screen flex flex-col justify-center items-center",children:[e.jsxs("div",{className:"flex flex-col justify-center items-center gap-14 m-auto",children:[e.jsx("h1",{className:"text-5xl font-bold text-pink-400",children:"乖寶寶集點卡"}),e.jsx("section",{children:e.jsxs(O,{spacing:"20px",children:[e.jsx(h,{colorScheme:"pink",size:"lg",onClick:o,children:"新增集點卡"}),e.jsx(h,{colorScheme:"pink",size:"lg",variant:"outline",onClick:m,children:"查看集點卡"})]})}),e.jsx(me,{isOpen:s,onClose:r})]}),e.jsxs(W,{as:"footer",py:"4",textAlign:"center",className:"flex justify-center items-center",children:[e.jsx("span",{children:"2025"}),e.jsx(A,{href:ue,isExternal:!0,ml:"2",children:e.jsx(ie,{src:xe,boxSize:"24px",alt:"GitHub Logo"})})]})]})};export{je as default};
