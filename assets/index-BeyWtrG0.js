import{f as _,u as z,o as U,g as $,j as e,c as W,a as G,r as g,h as v,b as q,L as Z}from"./index-MtHr8zwo.js";import{u as N,A as u,b as J,c as K,I as w,a as P,e as Q}from"./indexedDB-VbUPTGWN.js";import{a as b,B as j,s as p,u as f}from"./toast-BILEt0hQ.js";import{M as S,a as D,b as T,c as I,d as L,e as k,F as A,N as V,f as X,g as Y,h as ee,i as se,S as ae,j as te,k as ne,l as re,m as E,n as F,C as oe,v as ce,W as le,T as ie,o as de,p as xe,q as M,r as O,s as he,t as y,I as R,D as me}from"./validateCardForm-DwWc9knu.js";import{H as je}from"./Header-NSphvrS_.js";import{g as H}from"./getImageUrl-D1gqjwtB.js";const B=_(function(a,s){const r=z("Text",a),{className:t,align:o,decoration:c,casing:n,...d}=U(a),l=$({textAlign:a.align,textDecoration:a.decoration,textTransform:a.casing});return e.jsx(W.p,{ref:s,className:G("chakra-text",a.className),...l,...d,__css:r})});B.displayName="Text";const ue=i=>{const{isOpen:a,onClose:s,setCurrentCardData:r,currentCardData:t}=i,o=b(),{totalPoints:c,currentPoints:n}=t,[d,l]=g.useState(1),x=m=>{const C=typeof m=="string"?parseInt(m):m;l(C)},h=async m=>{try{const C={...t,currentPoints:n+m};await N(C),r(C),s()}catch(C){console.error(C),p(o,"新增點數失敗，請稍後再試。",u.ERROR)}};return e.jsxs(S,{onClose:s,size:"xs",isOpen:a,isCentered:!0,children:[e.jsx(D,{}),e.jsxs(T,{children:[e.jsx(I,{children:"新增"}),e.jsx(L,{}),e.jsx(k,{children:e.jsxs(A,{direction:"column",gap:4,children:["請輸入要增加的點數",e.jsxs(V,{min:1,max:c-n,maxW:"100px",value:d,onChange:x,children:[e.jsx(X,{}),e.jsxs(Y,{children:[e.jsx(ee,{}),e.jsx(se,{})]})]}),e.jsxs(ae,{min:1,max:c-n,width:"95%",flex:"1",focusThumbOnChange:!1,value:d,onChange:x,children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsx(re,{fontSize:"sm",boxSize:"32px",children:d})]})]})}),e.jsxs(E,{children:[e.jsx(j,{mr:3,onClick:s,children:"取消"}),e.jsx(j,{colorScheme:"pink",onClick:()=>{h(d),l(1)},children:"蓋章"})]})]})]})},pe=F({displayName:"EditIcon",path:e.jsxs("g",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeWidth:"2",children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),Ce=F({d:"M23.555,8.729a1.505,1.505,0,0,0-1.406-.98H16.062a.5.5,0,0,1-.472-.334L13.405,1.222a1.5,1.5,0,0,0-2.81,0l-.005.016L8.41,7.415a.5.5,0,0,1-.471.334H1.85A1.5,1.5,0,0,0,.887,10.4l5.184,4.3a.5.5,0,0,1,.155.543L4.048,21.774a1.5,1.5,0,0,0,2.31,1.684l5.346-3.92a.5.5,0,0,1,.591,0l5.344,3.919a1.5,1.5,0,0,0,2.312-1.683l-2.178-6.535a.5.5,0,0,1,.155-.543l5.194-4.306A1.5,1.5,0,0,0,23.555,8.729Z",displayName:"StarIcon"}),ge=i=>{const{isOpen:a,onClose:s}=i,r=b(),{cardId:t=""}=v(),o=q(),c=async()=>{try{await J(t),p(r,"刪除成功！！",u.SUCCESS),s(),o("/list")}catch(n){console.error(n),p(r,"刪除失敗，請稍後再試。",u.ERROR)}};return e.jsxs(S,{onClose:s,isOpen:a,isCentered:!0,size:"xs",children:[e.jsx(D,{}),e.jsxs(T,{children:[e.jsx(I,{children:"刪除"}),e.jsx(k,{children:"是否要刪除集點卡？"}),e.jsxs(E,{children:[e.jsx(j,{mr:3,onClick:s,children:"取消"}),e.jsx(j,{colorScheme:"red",onClick:c,children:"刪除"})]})]})]})},fe=i=>{const{isOpen:a,onClose:s,currentCardData:r,setCurrentCardData:t}=i,o=b(),[c,n]=g.useState({}),d=async()=>{if(ce(r,n))try{await N(r),p(o,"更新成功！！",u.SUCCESS),s()}catch(l){console.error(l),p(o,"更新失敗，請稍後再試。",u.ERROR,e.jsx(le,{mt:"5px"}))}};return e.jsxs(S,{onClose:s,isOpen:a,isCentered:!0,size:"sm",scrollBehavior:"inside",closeOnOverlayClick:!1,trapFocus:!1,children:[e.jsx(D,{}),e.jsxs(T,{children:[e.jsx(I,{children:"編輯"}),e.jsx(k,{children:e.jsx(oe,{mode:K.EDIT,cardData:r,setCardData:t,errors:c,setErrors:n})}),e.jsxs(E,{children:[e.jsx(j,{mr:3,onClick:s,children:"取消"}),e.jsx(j,{colorScheme:"pink",onClick:d,children:"儲存"})]})]})]})},be=i=>{const{isOpen:a,onClose:s,currentCardData:r,setCurrentCardData:t}=i,o=b(),{redemptionList:c,currentPoints:n}=r,d=c.sort((x,h)=>x.points-h.points),l=async x=>{if(!(n<x))try{const h={...r,currentPoints:n-x};await N(h),t(h),p(o,"兌換成功！！",u.SUCCESS),s()}catch(h){console.error(h),p(o,"兌換失敗，請稍後再試。",u.ERROR)}};return e.jsxs(S,{onClose:s,isOpen:a,isCentered:!0,size:"xs",children:[e.jsx(D,{}),e.jsxs(T,{children:[e.jsx(I,{children:"兌換"}),e.jsx(L,{}),e.jsx(k,{children:e.jsx(ie,{mb:8,children:e.jsxs(de,{children:[e.jsx(xe,{children:e.jsxs(M,{children:[e.jsx(O,{children:"獎勵"}),e.jsx(O,{isNumeric:!0,children:"消耗點數"}),e.jsx(O,{})]})}),e.jsx(he,{children:d.map(({id:x,content:h,points:m})=>e.jsxs(M,{children:[e.jsx(y,{children:h}),e.jsx(y,{isNumeric:!0,children:m}),e.jsx(y,{width:"10%",p:0,children:e.jsx(j,{colorScheme:"pink",size:"xs",onClick:()=>l(m),isDisabled:n<m,children:"兌換"})})]},x))})]})})})]})]})},Se=i=>{const{currentCardData:a,setCurrentCardData:s}=i,{isOpen:r,onOpen:t,onClose:o}=f(),{isOpen:c,onOpen:n,onClose:d}=f(),{isOpen:l,onOpen:x,onClose:h}=f();return e.jsxs(e.Fragment,{children:[e.jsxs(A,{mb:2,justifyContent:"space-between",gap:6,children:[e.jsx(j,{leftIcon:e.jsx(Ce,{}),colorScheme:"pink",flexGrow:1,onClick:()=>x(),children:"兌換獎勵"}),e.jsxs("div",{children:[e.jsx(R,{colorScheme:"blue","aria-label":"Edit data",icon:e.jsx(pe,{}),mr:1,onClick:()=>n()}),e.jsx(R,{colorScheme:"red","aria-label":"Delete data",icon:e.jsx(me,{}),onClick:()=>t()})]})]}),e.jsx(ge,{isOpen:r,onClose:o}),e.jsx(fe,{isOpen:c,onClose:d,currentCardData:a,setCurrentCardData:s}),e.jsx(be,{isOpen:l,onClose:h,currentCardData:a,setCurrentCardData:s})]})},De=`${P}/point.webp`,Te=i=>{const{totalPoints:a,currentPoints:s,pointImage:r}=i,[t,o]=g.useState(!0),c=H(r,De),n=()=>{setTimeout(()=>{o(!1)},500)};return Array.from({length:a},(d,l)=>e.jsxs("div",{className:"w-14 h-14 border-solid border-2 rounded-xl border-pink-500 flex items-center justify-center relative bg-pink-100/50",children:[e.jsx(B,{fontSize:"xl",as:"b",color:"pink.700",opacity:.6,children:l+1}),s>l&&e.jsxs("div",{className:`w-16 h-16 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex clip-circle ${t?"bg-white/80":""} `,children:[e.jsx("div",{className:`absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 -rotate-[30deg] w-16 h-16  bg-pink-200 animate-pulse ${t?"block":"hidden"}`}),e.jsx(w,{src:c,alt:"point",borderRadius:"full",objectFit:"cover",className:`-rotate-[30deg] w-full ${t?"opacity-0":"opacity-100"}`,onLoad:n})]})]},l))},Ie=`${P}/cardHeader.webp`,Re=()=>{const{cardId:i=""}=v(),{isOpen:a,onOpen:s,onClose:r}=f(),[t,o]=g.useState(null),{totalPoints:c=0,currentPoints:n=0,pointImage:d=null,cardHeaderImage:l=null}=t||{},x=H(l,Ie);return g.useEffect(()=>{(async()=>{const m=await Q(i);o(m)})()},[i]),e.jsxs("div",{className:"flex flex-col items-center h-screen",children:[e.jsx(je,{}),e.jsx("section",{className:"mt-12 w-full px-5 pb-8 max-w-lg",children:t?e.jsxs(e.Fragment,{children:[e.jsx(Se,{currentCardData:t,setCurrentCardData:o}),e.jsxs("div",{className:"border-solid border-4 border-pink-500 rounded-xl p-2 flex flex-col items-center ",children:[e.jsx(w,{src:x,alt:"card-header-picture",objectFit:"cover",className:"w-full max-h-[200px]"}),e.jsx("div",{className:"grid grid-cols-5 gap-1 mt-3",onClick:()=>{n<c&&s()},children:e.jsx(Te,{totalPoints:c,currentPoints:n,pointImage:d})}),e.jsx(ue,{isOpen:a,onClose:r,setCurrentCardData:o,currentCardData:t})]})]}):e.jsx("div",{children:e.jsxs("div",{className:"font-bold mt-6 text-center text-lg",children:["查無此集點卡，",e.jsx(Z,{to:"/",className:"underline",children:"返回首頁"})]})})})]})};export{Re as default};
