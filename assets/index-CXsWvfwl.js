import{f as _,u as z,o as U,g as $,j as e,c as W,a as G,r as g,h as w,b as q,L as Z}from"./index-Dr4ijXKz.js";import{u as N,A as p,d as J,I as E,a as P,b as K}from"./indexedDB-Bs-VvnGT.js";import{a as b,B as u,s as C,u as f}from"./toast-CuYQmoM6.js";import{M as S,a as D,b as T,c as k,d as L,e as I,F as A,N as Q,f as V,g as X,h as Y,i as ee,S as se,j as te,k as ae,l as ne,m as R,n as F,C as re,v as oe,W as ce,T as le,o as ie,p as de,q as M,r as O,s as xe,t as y,I as v,D as he}from"./validateCardForm-F8NJdXX4.js";import{H as me}from"./Header-DyfecfBH.js";import{g as H}from"./getImageUrl-VL8xLnK6.js";const B=_(function(t,s){const r=z("Text",t),{className:a,align:o,decoration:c,casing:n,...d}=U(t),l=$({textAlign:t.align,textDecoration:t.decoration,textTransform:t.casing});return e.jsx(W.p,{ref:s,className:G("chakra-text",t.className),...l,...d,__css:r})});B.displayName="Text";const je=i=>{const{isOpen:t,onClose:s,setCurrentCardData:r,currentCardData:a}=i,o=b(),{totalPoints:c,currentPoints:n}=a,[d,l]=g.useState(1),h=m=>{const j=typeof m=="string"?parseInt(m):m;l(j)},x=async m=>{try{const j={...a,currentPoints:n+m};await N(j),r(j),s()}catch(j){console.error(j),C(o,"新增點數失敗，請稍後再試。",p.ERROR)}};return e.jsxs(S,{onClose:s,size:"xs",isOpen:t,isCentered:!0,children:[e.jsx(D,{}),e.jsxs(T,{children:[e.jsx(k,{children:"新增"}),e.jsx(L,{}),e.jsx(I,{children:e.jsxs(A,{direction:"column",gap:4,children:["請輸入要增加的點數",e.jsxs(Q,{min:1,max:c-n,maxW:"100px",value:d,onChange:h,children:[e.jsx(V,{}),e.jsxs(X,{children:[e.jsx(Y,{}),e.jsx(ee,{})]})]}),e.jsxs(se,{min:1,max:c-n,width:"95%",flex:"1",focusThumbOnChange:!1,value:d,onChange:h,children:[e.jsx(te,{children:e.jsx(ae,{})}),e.jsx(ne,{fontSize:"sm",boxSize:"32px",children:d})]})]})}),e.jsxs(R,{children:[e.jsx(u,{mr:3,onClick:s,children:"取消"}),e.jsx(u,{colorScheme:"pink",onClick:()=>{x(d),l(1)},children:"蓋章"})]})]})]})},ue=F({displayName:"EditIcon",path:e.jsxs("g",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeWidth:"2",children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),pe=F({d:"M23.555,8.729a1.505,1.505,0,0,0-1.406-.98H16.062a.5.5,0,0,1-.472-.334L13.405,1.222a1.5,1.5,0,0,0-2.81,0l-.005.016L8.41,7.415a.5.5,0,0,1-.471.334H1.85A1.5,1.5,0,0,0,.887,10.4l5.184,4.3a.5.5,0,0,1,.155.543L4.048,21.774a1.5,1.5,0,0,0,2.31,1.684l5.346-3.92a.5.5,0,0,1,.591,0l5.344,3.919a1.5,1.5,0,0,0,2.312-1.683l-2.178-6.535a.5.5,0,0,1,.155-.543l5.194-4.306A1.5,1.5,0,0,0,23.555,8.729Z",displayName:"StarIcon"}),Ce=i=>{const{isOpen:t,onClose:s}=i,r=b(),{cardId:a=""}=w(),o=q(),c=async()=>{try{await J(a),C(r,"刪除成功！！",p.SUCCESS),s(),o("/list")}catch(n){console.error(n),C(r,"刪除失敗，請稍後再試。",p.ERROR)}};return e.jsxs(S,{onClose:s,isOpen:t,isCentered:!0,size:"xs",children:[e.jsx(D,{}),e.jsxs(T,{children:[e.jsx(k,{children:"刪除"}),e.jsx(I,{children:"是否要刪除集點卡？"}),e.jsxs(R,{children:[e.jsx(u,{mr:3,onClick:s,children:"取消"}),e.jsx(u,{colorScheme:"red",onClick:c,children:"刪除"})]})]})]})},ge=i=>{const{isOpen:t,onClose:s,currentCardData:r,setCurrentCardData:a}=i,o=b(),[c,n]=g.useState({}),d=async()=>{if(oe(r,n))try{await N(r),C(o,"更新成功！！",p.SUCCESS),s()}catch(l){console.error(l),C(o,"更新失敗，請稍後再試。",p.ERROR,e.jsx(ce,{mt:"5px"}))}};return e.jsxs(S,{onClose:s,isOpen:t,isCentered:!0,size:"sm",scrollBehavior:"inside",closeOnOverlayClick:!1,children:[e.jsx(D,{}),e.jsxs(T,{children:[e.jsx(k,{children:"編輯"}),e.jsx(I,{children:e.jsx(re,{mode:"edit",cardData:r,setCardData:a,errors:c,setErrors:n})}),e.jsxs(R,{children:[e.jsx(u,{mr:3,onClick:s,children:"取消"}),e.jsx(u,{colorScheme:"pink",onClick:d,children:"儲存"})]})]})]})},fe=i=>{const{isOpen:t,onClose:s,currentCardData:r,setCurrentCardData:a}=i,o=b(),{redemptionList:c,currentPoints:n}=r,d=c.sort((h,x)=>h.points-x.points),l=async h=>{if(!(n<h))try{const x={...r,currentPoints:n-h};await N(x),a(x),C(o,"兌換成功！！",p.SUCCESS),s()}catch(x){console.error(x),C(o,"兌換失敗，請稍後再試。",p.ERROR)}};return e.jsxs(S,{onClose:s,isOpen:t,isCentered:!0,size:"xs",children:[e.jsx(D,{}),e.jsxs(T,{children:[e.jsx(k,{children:"兌換"}),e.jsx(L,{}),e.jsx(I,{children:e.jsx(le,{mb:8,children:e.jsxs(ie,{children:[e.jsx(de,{children:e.jsxs(M,{children:[e.jsx(O,{children:"獎勵"}),e.jsx(O,{isNumeric:!0,children:"消耗點數"}),e.jsx(O,{})]})}),e.jsx(xe,{children:d.map(({id:h,content:x,points:m})=>e.jsxs(M,{children:[e.jsx(y,{children:x}),e.jsx(y,{isNumeric:!0,children:m}),e.jsx(y,{width:"10%",p:0,children:e.jsx(u,{colorScheme:"pink",size:"xs",onClick:()=>l(m),isDisabled:n<m,children:"兌換"})})]},h))})]})})})]})]})},be=i=>{const{currentCardData:t,setCurrentCardData:s}=i,{isOpen:r,onOpen:a,onClose:o}=f(),{isOpen:c,onOpen:n,onClose:d}=f(),{isOpen:l,onOpen:h,onClose:x}=f();return e.jsxs(e.Fragment,{children:[e.jsxs(A,{mb:2,justifyContent:"space-between",gap:6,children:[e.jsx(u,{leftIcon:e.jsx(pe,{}),colorScheme:"pink",flexGrow:1,onClick:()=>h(),children:"兌換獎勵"}),e.jsxs("div",{children:[e.jsx(v,{colorScheme:"blue","aria-label":"Edit data",icon:e.jsx(ue,{}),mr:1,onClick:()=>n()}),e.jsx(v,{colorScheme:"red","aria-label":"Delete data",icon:e.jsx(he,{}),onClick:()=>a()})]})]}),e.jsx(Ce,{isOpen:r,onClose:o}),e.jsx(ge,{isOpen:c,onClose:d,currentCardData:t,setCurrentCardData:s}),e.jsx(fe,{isOpen:l,onClose:x,currentCardData:t,setCurrentCardData:s})]})},Se=`${P}/point.webp`,De=i=>{const{totalPoints:t,currentPoints:s,pointImage:r}=i,[a,o]=g.useState(!0),c=H(r,Se),n=()=>{setTimeout(()=>{o(!1)},500)};return Array.from({length:t},(d,l)=>e.jsxs("div",{className:"w-14 h-14 border-solid border-2 rounded-xl border-pink-500 flex items-center justify-center relative bg-pink-100/50",children:[e.jsx(B,{fontSize:"xl",as:"b",color:"pink.700",opacity:.6,children:l+1}),s>l&&e.jsxs("div",{className:`w-16 h-16 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex clip-circle ${a?"bg-white/80":""} `,children:[e.jsx("div",{className:`absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 -rotate-[30deg] w-16 h-16  bg-pink-200 animate-pulse ${a?"block":"hidden"}`}),e.jsx(E,{src:c,alt:"point",borderRadius:"full",objectFit:"cover",className:`-rotate-[30deg] w-full ${a?"opacity-0":"opacity-100"}`,onLoad:n})]})]},l))},Te=`${P}/cardHeader.webp`,Me=()=>{const{cardId:i=""}=w(),{isOpen:t,onOpen:s,onClose:r}=f(),[a,o]=g.useState(null),{totalPoints:c=0,currentPoints:n=0,pointImage:d=null,cardHeaderImage:l=null}=a||{},h=H(l,Te),x=async m=>{const j=await K(m);o(j)};return g.useEffect(()=>{x(i)},[i]),e.jsxs("div",{className:"flex flex-col items-center h-screen",children:[e.jsx(me,{}),e.jsx("section",{className:"mt-12 w-full px-5 pb-8 max-w-lg",children:a?e.jsxs(e.Fragment,{children:[e.jsx(be,{currentCardData:a,setCurrentCardData:o}),e.jsxs("div",{className:"border-solid border-4 border-pink-500 rounded-xl p-2 flex flex-col items-center ",onClick:()=>{n<c&&s()},children:[e.jsx(E,{src:h,alt:"card-header-picture",objectFit:"cover",className:"w-full max-h-[200px]"}),e.jsx("div",{className:"grid grid-cols-5 gap-1 mt-3",children:e.jsx(De,{totalPoints:c,currentPoints:n,pointImage:d})}),e.jsx(je,{isOpen:t,onClose:r,setCurrentCardData:o,currentCardData:a})]})]}):e.jsx("div",{children:e.jsxs("div",{className:"font-bold mt-6 text-center text-lg",children:["查無此集點卡，",e.jsx(Z,{to:"/",className:"underline",children:"返回首頁"})]})})})]})};export{Me as default};
