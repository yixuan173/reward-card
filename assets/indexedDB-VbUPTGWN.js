import{r as D,v as $,f as j,j as y,w as K,c as M}from"./index-MtHr8zwo.js";const fe=e=>e?"":void 0,le=e=>e?!0:void 0;function G(e,t){if(e!=null){if(typeof e=="function"){e(t);return}try{e.current=t}catch{throw new Error(`Cannot assign value '${t}' to ref '${e}'`)}}}function X(...e){return t=>{e.forEach(n=>{G(n,t)})}}function Ie(...e){return D.useMemo(()=>X(...e),e)}function z(e){const{loading:t,src:n,srcSet:r,onLoad:o,onError:a,crossOrigin:s,sizes:d,ignoreFallback:i}=e,[c,g]=D.useState("pending");D.useEffect(()=>{g(n?"loading":"pending")},[n]);const f=D.useRef(),S=D.useCallback(()=>{if(!n)return;m();const u=new Image;u.src=n,s&&(u.crossOrigin=s),r&&(u.srcset=r),d&&(u.sizes=d),t&&(u.loading=t),u.onload=h=>{m(),g("loaded"),o==null||o(h)},u.onerror=h=>{m(),g("failed"),a==null||a(h)},f.current=u},[n,s,r,d,o,a,t]),m=()=>{f.current&&(f.current.onload=null,f.current.onerror=null,f.current=null)};return $(()=>{if(!i)return c==="loading"&&S(),()=>{m()}},[c,S,i]),i?"loaded":c}const H=(e,t)=>e!=="loaded"&&t==="beforeLoadOrError"||e==="failed"&&t==="onError",T=j(function(t,n){const{htmlWidth:r,htmlHeight:o,alt:a,...s}=t;return y.jsx("img",{width:r,height:o,ref:n,alt:a,...s})});T.displayName="NativeImage";const Y=j(function(t,n){const{fallbackSrc:r,fallback:o,src:a,srcSet:s,align:d,fit:i,loading:c,ignoreFallback:g,crossOrigin:f,fallbackStrategy:S="beforeLoadOrError",referrerPolicy:m,...u}=t,h=r!==void 0||o!==void 0,_=c!=null||g||!h,W=z({...t,crossOrigin:f,ignoreFallback:_}),U=H(W,S),O={ref:n,objectFit:i,objectPosition:d,..._?u:K(u,["onError","onLoad"])};return U?o||y.jsx(M.img,{as:T,className:"chakra-image__placeholder",src:r,...O}):y.jsx(M.img,{as:T,src:a,srcSet:s,crossOrigin:f,loading:c,referrerPolicy:m,className:"chakra-image",...O})});Y.displayName="Image";const J="reward-card-db",I={CARD_LIST:"cardList"},me={CREATE:"create",EDIT:"edit"},ge={TIME_ASC:"timeASC",TIME_DESC:"timeDESC",TOTAL_POINTS_ASC:"totalPointsASC",TOTAL_POINTS_DESC:"totalPointsDESC",CURRENT_POINTS_ASC:"currentPointsASC",CURRENT_POINTS_DESC:"currentPointsDESC"},he={INFO:"info",WARNING:"warning",SUCCESS:"success",ERROR:"error",LOADING:"loading"},De=10,Q="https://yixuan173.github.io/reward-card",Ee=`${Q}/images`,A=(e,t)=>t.some(n=>e instanceof n);let N,x;function Z(){return N||(N=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function q(){return x||(x=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const L=new WeakMap,b=new WeakMap,C=new WeakMap;function ee(e){const t=new Promise((n,r)=>{const o=()=>{e.removeEventListener("success",a),e.removeEventListener("error",s)},a=()=>{n(l(e.result)),o()},s=()=>{r(e.error),o()};e.addEventListener("success",a),e.addEventListener("error",s)});return C.set(t,e),t}function te(e){if(L.has(e))return;const t=new Promise((n,r)=>{const o=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",s),e.removeEventListener("abort",s)},a=()=>{n(),o()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",a),e.addEventListener("error",s),e.addEventListener("abort",s)});L.set(e,t)}let R={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return L.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return l(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function v(e){R=e(R)}function ne(e){return q().includes(e)?function(...t){return e.apply(B(this),t),l(this.request)}:function(...t){return l(e.apply(B(this),t))}}function re(e){return typeof e=="function"?ne(e):(e instanceof IDBTransaction&&te(e),A(e,Z())?new Proxy(e,R):e)}function l(e){if(e instanceof IDBRequest)return ee(e);if(b.has(e))return b.get(e);const t=re(e);return t!==e&&(b.set(e,t),C.set(t,e)),t}const B=e=>C.get(e);function oe(e,t,{blocked:n,upgrade:r,blocking:o,terminated:a}={}){const s=indexedDB.open(e,t),d=l(s);return r&&s.addEventListener("upgradeneeded",i=>{r(l(s.result),i.oldVersion,i.newVersion,l(s.transaction),i)}),n&&s.addEventListener("blocked",i=>n(i.oldVersion,i.newVersion,i)),d.then(i=>{a&&i.addEventListener("close",()=>a()),o&&i.addEventListener("versionchange",c=>o(c.oldVersion,c.newVersion,c))}).catch(()=>{}),d}const se=["get","getKey","getAll","getAllKeys","count"],ae=["put","add","delete","clear"],w=new Map;function k(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(w.get(t))return w.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,o=ae.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(o||se.includes(n)))return;const a=async function(s,...d){const i=this.transaction(s,o?"readwrite":"readonly");let c=i.store;return r&&(c=c.index(d.shift())),(await Promise.all([c[n](...d),o&&i.done]))[0]};return w.set(t,a),a}v(e=>({...e,get:(t,n,r)=>k(t,n)||e.get(t,n,r),has:(t,n)=>!!k(t,n)||e.has(t,n)}));const ie=["continue","continuePrimaryKey","advance"],p={},P=new WeakMap,V=new WeakMap,ce={get(e,t){if(!ie.includes(t))return e[t];let n=p[t];return n||(n=p[t]=function(...r){P.set(this,V.get(this)[t](...r))}),n}};async function*de(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,ce);for(V.set(n,t),C.set(n,B(t));t;)yield n,t=await(P.get(n)||t.continue()),P.delete(n)}function F(e,t){return t===Symbol.asyncIterator&&A(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&A(e,[IDBIndex,IDBObjectStore])}v(e=>({...e,get(t,n,r){return F(t,n)?de:e.get(t,n,r)},has(t,n){return F(t,n)||e.has(t,n)}}));const E=oe(J,1,{upgrade(e){e.objectStoreNames.contains(I.CARD_LIST)||e.createObjectStore(I.CARD_LIST,{keyPath:"id"})}}),Se=async()=>{try{return await(await E).getAll(I.CARD_LIST)}catch(e){return console.error(e),[]}},Ce=async e=>{try{const n=await(await E).get(I.CARD_LIST,e);if(!n)throw new Error("Card not found");return n}catch(t){return console.error(t),null}},be=async e=>{await(await E).add(I.CARD_LIST,e)},we=async e=>{await(await E).put(I.CARD_LIST,e)},ye=async e=>{await(await E).delete(I.CARD_LIST,e)};export{he as A,Y as I,De as M,ge as S,Ee as a,ye as b,me as c,fe as d,Ce as e,Ie as f,Se as g,be as h,le as i,X as m,we as u};
