import{r as w,s as U,f as p,j as C,v as G,c as N}from"./index-Dr4ijXKz.js";function X(e){const{loading:t,src:n,srcSet:r,onLoad:o,onError:a,crossOrigin:s,sizes:d,ignoreFallback:i}=e,[c,g]=w.useState("pending");w.useEffect(()=>{g(n?"loading":"pending")},[n]);const f=w.useRef(),b=w.useCallback(()=>{if(!n)return;m();const u=new Image;u.src=n,s&&(u.crossOrigin=s),r&&(u.srcset=r),d&&(u.sizes=d),t&&(u.loading=t),u.onload=h=>{m(),g("loaded"),o==null||o(h)},u.onerror=h=>{m(),g("failed"),a==null||a(h)},f.current=u},[n,s,r,d,o,a,t]),m=()=>{f.current&&(f.current.onload=null,f.current.onerror=null,f.current=null)};return U(()=>{if(!i)return c==="loading"&&b(),()=>{m()}},[c,b,i]),i?"loaded":c}const $=(e,t)=>e!=="loaded"&&t==="beforeLoadOrError"||e==="failed"&&t==="onError",L=p(function(t,n){const{htmlWidth:r,htmlHeight:o,alt:a,...s}=t;return C.jsx("img",{width:r,height:o,ref:n,alt:a,...s})});L.displayName="NativeImage";const z=p(function(t,n){const{fallbackSrc:r,fallback:o,src:a,srcSet:s,align:d,fit:i,loading:c,ignoreFallback:g,crossOrigin:f,fallbackStrategy:b="beforeLoadOrError",referrerPolicy:m,...u}=t,h=r!==void 0||o!==void 0,P=c!=null||g||!h,W=X({...t,crossOrigin:f,ignoreFallback:P}),K=$(W,b),M={ref:n,objectFit:i,objectPosition:d,...P?u:G(u,["onError","onLoad"])};return K?o||C.jsx(N.img,{as:L,className:"chakra-image__placeholder",src:r,...M}):C.jsx(N.img,{as:L,src:a,srcSet:s,crossOrigin:f,loading:c,referrerPolicy:m,className:"chakra-image",...M})});z.displayName="Image";const H="reward-card-db",I={CARD_LIST:"cardList"},de={INFO:"info",WARNING:"warning",SUCCESS:"success",ERROR:"error",LOADING:"loading"},ue=10,J="https://yixuan173.github.io/reward-card",fe=`${J}/images`,B=(e,t)=>t.some(n=>e instanceof n);let k,O;function Q(){return k||(k=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Y(){return O||(O=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const A=new WeakMap,E=new WeakMap,y=new WeakMap;function Z(e){const t=new Promise((n,r)=>{const o=()=>{e.removeEventListener("success",a),e.removeEventListener("error",s)},a=()=>{n(l(e.result)),o()},s=()=>{r(e.error),o()};e.addEventListener("success",a),e.addEventListener("error",s)});return y.set(t,e),t}function q(e){if(A.has(e))return;const t=new Promise((n,r)=>{const o=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",s),e.removeEventListener("abort",s)},a=()=>{n(),o()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",a),e.addEventListener("error",s),e.addEventListener("abort",s)});A.set(e,t)}let T={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return A.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return l(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function v(e){T=e(T)}function ee(e){return Y().includes(e)?function(...t){return e.apply(x(this),t),l(this.request)}:function(...t){return l(e.apply(x(this),t))}}function te(e){return typeof e=="function"?ee(e):(e instanceof IDBTransaction&&q(e),B(e,Q())?new Proxy(e,T):e)}function l(e){if(e instanceof IDBRequest)return Z(e);if(E.has(e))return E.get(e);const t=te(e);return t!==e&&(E.set(e,t),y.set(t,e)),t}const x=e=>y.get(e);function ne(e,t,{blocked:n,upgrade:r,blocking:o,terminated:a}={}){const s=indexedDB.open(e,t),d=l(s);return r&&s.addEventListener("upgradeneeded",i=>{r(l(s.result),i.oldVersion,i.newVersion,l(s.transaction),i)}),n&&s.addEventListener("blocked",i=>n(i.oldVersion,i.newVersion,i)),d.then(i=>{a&&i.addEventListener("close",()=>a()),o&&i.addEventListener("versionchange",c=>o(c.oldVersion,c.newVersion,c))}).catch(()=>{}),d}const re=["get","getKey","getAll","getAllKeys","count"],oe=["put","add","delete","clear"],S=new Map;function F(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(S.get(t))return S.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,o=oe.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(o||re.includes(n)))return;const a=async function(s,...d){const i=this.transaction(s,o?"readwrite":"readonly");let c=i.store;return r&&(c=c.index(d.shift())),(await Promise.all([c[n](...d),o&&i.done]))[0]};return S.set(t,a),a}v(e=>({...e,get:(t,n,r)=>F(t,n)||e.get(t,n,r),has:(t,n)=>!!F(t,n)||e.has(t,n)}));const se=["continue","continuePrimaryKey","advance"],_={},R=new WeakMap,V=new WeakMap,ae={get(e,t){if(!se.includes(t))return e[t];let n=_[t];return n||(n=_[t]=function(...r){R.set(this,V.get(this)[t](...r))}),n}};async function*ie(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,ae);for(V.set(n,t),y.set(n,x(t));t;)yield n,t=await(R.get(n)||t.continue()),R.delete(n)}function j(e,t){return t===Symbol.asyncIterator&&B(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&B(e,[IDBIndex,IDBObjectStore])}v(e=>({...e,get(t,n,r){return j(t,n)?ie:e.get(t,n,r)},has(t,n){return j(t,n)||e.has(t,n)}}));const D=ne(H,1,{upgrade(e){e.objectStoreNames.contains(I.CARD_LIST)||e.createObjectStore(I.CARD_LIST,{keyPath:"id"})}}),le=async()=>{try{return await(await D).getAll(I.CARD_LIST)}catch(e){return console.error(e),[]}},Ie=async e=>{try{const n=await(await D).get(I.CARD_LIST,e);if(!n)throw new Error("Card not found");return n}catch(t){return console.error(t),null}},me=async e=>{await(await D).add(I.CARD_LIST,e)},ge=async e=>{await(await D).put(I.CARD_LIST,e)},he=async e=>{await(await D).delete(I.CARD_LIST,e)};export{de as A,z as I,ue as M,fe as a,Ie as b,me as c,he as d,le as g,ge as u};
